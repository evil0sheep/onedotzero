- name: Configure compute nodes
  hosts: compute
  connection: ssh
  become: true
  gather_facts: true
  vars_files:
    - "hardware_vars/{{ hardware_version }}.yml"

  pre_tasks:
    - name: Remove old SSH host key for compute node
      ansible.builtin.known_hosts:
        name: "{{ inventory_hostname }}"
        state: absent
      delegate_to: localhost

  roles:
    - networkd_wol

  tasks:
    - name: Include hardware-specific configuration roles
      ansible.builtin.include_role:
        name: "{{ item }}"
      loop: "{{ hardware_compute_configure_roles | default([]) }}"
